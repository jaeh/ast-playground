<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/favicon.ico"/><title>@magic/core concepts</title><meta name="description" content="@magic/core conceptual information."/><link rel="stylesheet" href="/magic.css?EvPdYRhMuET"/></head><body><div id="Magic"><div class="Wrapper"><header class="Header"><a class="LogoWrapper" href="/"><img class="Logo" src="/logo.png" role="presentation" alt=""/><span class="LogoText">@magic</span></a><nav class="Menu"><ul><li class="MenuItem active"><a href="/core/concepts/">concepts</a><ul><li class="MenuItem"><a href="/core/concepts/#modules">modules</a></li><li class="MenuItem"><a href="/core/concepts/#state">state</a></li><li class="MenuItem"><a href="/core/concepts/#actions">actions</a></li><li class="MenuItem"><a href="/core/concepts/#views">views</a></li><li class="MenuItem"><a href="/core/concepts/#styles">styles</a></li><li class="MenuItem"><a href="/core/concepts/#globals">global</a></li><li class="MenuItem"><a href="/core/concepts/#lambdas">server lambdas</a></li><li class="MenuItem"><a href="/core/concepts/#libs">external libs</a></li><li class="MenuItem"><a href="/core/concepts/#full-example">example</a></li></ul></li><li class="MenuItem"><a href="/core/files/">files &amp; directories</a></li><li class="MenuItem"><a href="/core/modules/">modules</a></li><li class="MenuItem"><a href="/core/themes/">themes</a></li><li class="MenuItem"><a href="/core/libraries/">libraries</a></li></ul></nav></header><div class="Page"><h1></h1><p>magic concepts. These are the building blocks of every module in a magic app</p><div><h2 id="modules">@magic-modules</h2><p>modules are the main building block of magic.</p><p>a page is a module, a button is a module, a link is a module, an image is a module. a @magic app contains modules containing modules that contain modules. this can lead to inception.</p></div><div><h2 id="state">state</h2><div><p>state is a javascript object.</p><p>state can be mutated by actions.</p><p>every rendering step, the state determines the output of the view</p><h3 id="state-example">state example</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// <span class="state">state</span> variables can be anything you can <span class="builtin">JSON</span>.<span class="property">stringify</span>()</span></code><code class="line"><span class="state">state</span>: {</code><code class="line">  <span class="colon">variable</span>: <span class="boolean">true</span>,</code><code class="line">  <span class="colon">args</span>: <span class="string">&#39;none&#39;</span>,</code><code class="line">}</code></pre></div></div></div><div><h2 id="actions">actions</h2><p>actions are an object containing functions</p><p>those functions get the state and actions and may return a new partial state.</p><p>alternatively, you can call any action from within any other action.</p><h3 id="actions-example">actions example</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// <span class="actions">actions</span> are an object containing <span class="object">functions</span>.</span></code><code class="line"><span class="comment">// <span class="keyword">if</span> an action returns an object, <span class="keyword">this</span> object gets merged into the <span class="state">state</span></span></code><code class="line"><span class="actions">actions</span>: {</code><code class="line">  <span class="colon">changeVariable</span>: args =&gt; <span class="state">state</span> =&gt; ({</code><code class="line">    <span class="colon">variable</span>: !<span class="state">state</span>.<span class="property">variable</span>,</code><code class="line">    args,</code><code class="line">  }),</code><code class="line">  <span class="colon">callActionInAction</span>: () =&gt; <span class="keyword">async</span> (<span class="state">state</span>, <span class="actions">actions</span>) =&gt; {</code><code class="line"><span class="comment">    // just <span class="keyword">await</span> something inside an action to create an <span class="keyword">async</span> action</span></code><code class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="builtin">Promise</span>(resolve =&gt; {</code><code class="line">      <span class="builtin">setTimeout</span>(resolve, 200)</code><code class="line">    })</code><code class="line"></code><code class="line"><span class="comment">    // <span class="actions">actions</span> can call other <span class="actions">actions</span></span></code><code class="line">    <span class="actions">actions</span>.<span class="property">changeVariable</span>(<span class="string">&#39;arg passed to <span class="keyword">function</span>&#39;</span>)</code><code class="line">  },</code><code class="line">}</code></pre></div></div><div><h2 id="views">views</h2><p>views render the state to html</p><p>whenever an action triggers a statechange, this statechange then triggers a view change.</p><h3 id="views-example">views example</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">View</span>: (<span class="state">state</span>, <span class="actions">actions</span>) =&gt; (</code><code class="line">  div({ <span class="colon">onclick</span>: <span class="actions">actions</span>.<span class="property">callActionInAction</span> }, <span class="state">state</span>.<span class="property">variable</span>)</code><code class="line">)</code></pre></div></div><div><h2 id="styles">styles</h2><p>every module can have a style object attached to it.</p><p>magic will automagically merge all styles into one global css file.</p><p>in the future, it will also remove unused styles for you.</p><p>style merge order from lowest to highest:</p><p>module.style &lt; page.style &lt; app.style &lt; theme.style</p><h3 id="styles-example">example styles</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">style</span>: {</code><code class="line">  <span class="string">&#39;.<span class="property">className</span>&#39;</span>: {</code><code class="line">    <span class="colon">color</span>: <span class="string">&#39;green&#39;</span>,</code><code class="line"></code><code class="line"><span class="comment">    // expands to .<span class="colon">className</span>:hover because of the &amp;</span></code><code class="line">    <span class="string">&#39;&amp;:hover&#39;</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;orange&#39;</span>,</code><code class="line">    },</code><code class="line"></code><code class="line"><span class="comment">    // expands to .className .childClass</span></code><code class="line">    <span class="string">&#39;.<span class="property">childClass</span>&#39;</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;blue&#39;</span>,</code><code class="line">    },</code><code class="line">  },</code><code class="line"><span class="comment">  // css ids</span></code><code class="line">  <span class="string">&#39;#id&#39;</span>: {</code><code class="line">    <span class="colon">color</span>: <span class="string">&#39;yellow&#39;</span>,</code><code class="line">  },</code><code class="line"><span class="comment">  // <span class="keyword">default</span> html tag styles</span></code><code class="line">  <span class="colon">div</span>: {</code><code class="line">    <span class="colon">color</span>: <span class="string">&#39;black&#39;</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div><h3 id="styles-magic-css">@magic/css</h3><p>internally, magic uses it&#39;s own css-in-js library.</p><p>to find out more, click the following link:</p><a href="https://magic.github.io/css/" target="_blank" rel="noopener">@magic/css</a></div><div><h2 id="globals">global</h2><p>every module can set a global object, containing state and action properties.</p><p>every key in the mod.global object that is set to true gets merged into the main app state/actions.</p><h3 id="globals-example">global example</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">global</span>: {</code><code class="line">  <span class="state">state</span>: {</code><code class="line">    <span class="colon">variable</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">args</span>: <span class="boolean">true</span>,</code><code class="line">  },</code><code class="line">  <span class="actions">actions</span>: {</code><code class="line">    <span class="colon">callActionInAction</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">changeVariable</span>: <span class="boolean">true</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div></div><div><h2 id="lambdas">server lambdas</h2><p>this is the serverside magic.</p><p>you can define functions that get transpiled into serverside lambdas.</p><p>server side lambdas will be available for GET and POST requests.</p><p>the server side function signature is (req, res) =&gt; {}, as in any nodejs http server, with the addition of req.body being awaited before execution of the lambda.</p><h3 id="lambdas-example">single lambda</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">server</span>: (req, res) =&gt; {</code><code class="line">  <span class="keyword">const</span> { name } = <span class="object">req</span>.<span class="property">body</span></code><code class="line">  <span class="object">res</span>.<span class="property">writeHead</span>(200, { <span class="string">&#39;content-type&#39;</span>: <span class="string">&#39;text<span class="keyword">/</span>plain&#39;</span> })</code><code class="line">  <span class="object">res</span>.<span class="property">end</span>(`hello, ${name}`)</code><code class="line">}</code></pre></div><h3 id="lambdas-example-multi">multiple lambdas</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">server</span>: {</code><code class="line">  <span class="colon">index</span>: (req, res) =&gt; {</code><code class="line">    <span class="object">res</span>.<span class="property">writeHead</span>(200, { <span class="string">&#39;content-type&#39;</span>: <span class="string">&#39;text<span class="keyword">/</span>plain&#39;</span> })</code><code class="line">    <span class="object">res</span>.<span class="property">end</span>(<span class="string">&#39;index route&#39;</span>)</code><code class="line">  },</code><code class="line">  <span class="colon">route</span>: (req, res) =&gt; {</code><code class="line">    <span class="object">res</span>.<span class="property">writeHead</span>(200, { <span class="string">&#39;content-type&#39;</span>: <span class="string">&#39;text<span class="keyword">/</span>plain&#39;</span> })</code><code class="line">    <span class="object">res</span>.<span class="property">end</span>(<span class="string">&#39;api route&#39;</span>)</code><code class="line">  },</code><code class="line">}</code></pre></div></div><div><h2 id="libs">external libs</h2><p>what would javascript be without the millions of dependencies that you can easily install and make the average webpage  slow[ly] (pun intended) grow towards a footprint of 5 megabytes.</p><p>as the sarcastic remark might demonstrate, we think that all of that bloat is unneeded, unheeded and, frankly, not optimal.</p><p>magic has one external client side dependency, <a href="https://github.com/jorgebucharan/hyperapp" target="_blank" rel="noopener">hyperapp</a>, [~400 lines that provide our ui state machine]. thats it. and it won&#39;t change.</p><p>anyways, rant over. if you really need to use external packages, there is a way.</p><p>once there is a lib key in at least one component, window.LIB (browser) and global.LIB (nodejs) will be set, aliasing LIB as a global variable in both environments</p><h3 id="libs-dir-or-file">lib dir or file</h3><p>if you need libraries in internally developed modules, it might be easier to keep your library dependencies in a central place. to achieve this, one can simply create /assets/lib.js and export an object from it. the keys of the object are the function name, the values are the paths to the lib.js file. to make sure resolution works, require.resolve has to be used for local libs.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">/</span>assets<span class="keyword">/</span><span class="object">lib</span>.<span class="property">js</span> or /assets<span class="keyword">/</span>lib<span class="keyword">/</span><span class="object">index</span>.<span class="property">js</span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</code><code class="line">  <span class="colon">local</span>: <span class="keyword">require</span>.<span class="property">resolve</span>(<span class="string">&#39;./<span class="object">local</span>.<span class="property">js</span>&#39;</span>),</code><code class="line">  <span class="colon">npm</span>: <span class="string">&#39;npm-lib&#39;</span>,</code><code class="line">}</code></pre></div><h3 id="libs-example-file">example lib file</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// <span class="keyword">/</span>assets<span class="keyword">/</span>lib<span class="keyword">/</span><span class="object">local</span>.<span class="property">js</span></span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> name =&gt; `hello, ${name}`</code></pre></div><h3 id="libs-app">app.lib</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// <span class="keyword">/</span>assets<span class="keyword">/</span><span class="object">app</span>.<span class="property">js</span></span></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</code><code class="line"><span class="comment">  // ... other app props</span></code><code class="line">    <span class="colon">lib</span>: {</code><code class="line">    <span class="colon">local</span>: <span class="keyword">require</span>.<span class="property">resolve</span>(<span class="string">&#39;./lib&#39;</span>),</code><code class="line">    <span class="colon">npm</span>: <span class="string">&#39;npm-lib&#39;</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div><h3 id="libs-module">module.lib</h3><p>any page or module can export a lib key</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="comment">// <span class="keyword">/</span>pages<span class="keyword">/</span><span class="object">page</span>.<span class="property">js</span></span></code><code class="line"><span class="comment">// <span class="keyword">/</span>assets<span class="keyword">/</span><span class="object">Module</span>.<span class="property">js</span></span></code><code class="line"></code><code class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</code><code class="line"><span class="comment">  // ... other component / page properties and views</span></code><code class="line">  <span class="colon">lib</span>: {</code><code class="line">    <span class="colon">local</span>: <span class="keyword">require</span>.<span class="property">resolve</span>(<span class="string">&#39;./lib<span class="keyword">/</span><span class="object">local</span>.<span class="property">js</span>&#39;</span>),</code><code class="line">    <span class="colon">npm</span>: <span class="string">&#39;npm-lib&#39;</span>,</code><code class="line">  }</code><code class="line">},</code><code class="line"><span class="colon">View</span>: () =&gt; div(<span class="object">LIB</span>.<span class="property">local</span>(<span class="string">&#39;name&#39;</span>)),</code><code class="line">      }</code><code class="line"></code><code class="line"><span class="comment">      // renders</span></code><code class="line">      &lt;div&gt;hello, name&lt;/div&gt;</code></pre></div></div><div><h2 id="full-example">Full example</h2><p>If we assemble those pieces, we get the following:</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> exampleModule = {</code><code class="line">    </code><code class="line"><span class="comment">  // <span class="state">state</span> variables can be anything you can <span class="builtin">JSON</span>.<span class="property">stringify</span>()</span></code><code class="line">  <span class="state">state</span>: {</code><code class="line">    <span class="colon">variable</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">args</span>: <span class="string">&#39;none&#39;</span>,</code><code class="line">  },</code><code class="line">    </code><code class="line"><span class="comment">  // <span class="actions">actions</span> are an object containing <span class="object">functions</span>.</span></code><code class="line"><span class="comment">  // <span class="keyword">if</span> an action returns an object, <span class="keyword">this</span> object gets merged into the <span class="state">state</span></span></code><code class="line">  <span class="actions">actions</span>: {</code><code class="line">    <span class="colon">changeVariable</span>: args =&gt; <span class="state">state</span> =&gt; ({</code><code class="line">      <span class="colon">variable</span>: !<span class="state">state</span>.<span class="property">variable</span>,</code><code class="line">      args,</code><code class="line">    }),</code><code class="line">    <span class="colon">callActionInAction</span>: () =&gt; <span class="keyword">async</span> (<span class="state">state</span>, <span class="actions">actions</span>) =&gt; {</code><code class="line"><span class="comment">      // just <span class="keyword">await</span> something inside an action to create an <span class="keyword">async</span> action</span></code><code class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="builtin">Promise</span>(resolve =&gt; {</code><code class="line">        <span class="builtin">setTimeout</span>(resolve, 200)</code><code class="line">      })</code><code class="line">  </code><code class="line"><span class="comment">      // <span class="actions">actions</span> can call other <span class="actions">actions</span></span></code><code class="line">      <span class="actions">actions</span>.<span class="property">changeVariable</span>(<span class="string">&#39;arg passed to <span class="keyword">function</span>&#39;</span>)</code><code class="line">    },</code><code class="line">  },</code><code class="line">    </code><code class="line">  <span class="colon">style</span>: {</code><code class="line">    <span class="string">&#39;.<span class="property">className</span>&#39;</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;green&#39;</span>,</code><code class="line">  </code><code class="line"><span class="comment">      // expands to .<span class="colon">className</span>:hover because of the &amp;</span></code><code class="line">      <span class="string">&#39;&amp;:hover&#39;</span>: {</code><code class="line">        <span class="colon">color</span>: <span class="string">&#39;orange&#39;</span>,</code><code class="line">      },</code><code class="line">  </code><code class="line"><span class="comment">      // expands to .className .childClass</span></code><code class="line">      <span class="string">&#39;.<span class="property">childClass</span>&#39;</span>: {</code><code class="line">        <span class="colon">color</span>: <span class="string">&#39;blue&#39;</span>,</code><code class="line">      },</code><code class="line">    },</code><code class="line"><span class="comment">    // css ids</span></code><code class="line">    <span class="string">&#39;#id&#39;</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;yellow&#39;</span>,</code><code class="line">    },</code><code class="line"><span class="comment">    // <span class="keyword">default</span> html tag styles</span></code><code class="line">    <span class="colon">div</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;black&#39;</span>,</code><code class="line">    },</code><code class="line">  },</code><code class="line">    </code><code class="line">  <span class="colon">View</span>: (<span class="state">state</span>, <span class="actions">actions</span>) =&gt; (</code><code class="line">    div({ <span class="colon">onclick</span>: <span class="actions">actions</span>.<span class="property">callActionInAction</span> }, <span class="state">state</span>.<span class="property">variable</span>)</code><code class="line">  ),</code><code class="line">    </code><code class="line">  <span class="colon">global</span>: {</code><code class="line">    <span class="state">state</span>: {</code><code class="line">      <span class="colon">variable</span>: <span class="boolean">true</span>,</code><code class="line">      <span class="colon">args</span>: <span class="boolean">true</span>,</code><code class="line">    },</code><code class="line">    <span class="actions">actions</span>: {</code><code class="line">      <span class="colon">callActionInAction</span>: <span class="boolean">true</span>,</code><code class="line">      <span class="colon">changeVariable</span>: <span class="boolean">true</span>,</code><code class="line">    },</code><code class="line">  },</code><code class="line">    </code><code class="line">  <span class="colon">lib</span>: {</code><code class="line">    <span class="colon">local</span>: <span class="keyword">require</span>.<span class="property">resolve</span>(<span class="string">&#39;./lib<span class="keyword">/</span><span class="object">local</span>.<span class="property">js</span>&#39;</span>),</code><code class="line">    <span class="colon">npm</span>: <span class="string">&#39;npm-lib&#39;</span>,</code><code class="line">  },</code><code class="line">    </code><code class="line">  <span class="colon">server</span>: (req, res) =&gt; {</code><code class="line">    <span class="keyword">const</span> { name } = <span class="object">req</span>.<span class="property">body</span></code><code class="line">    <span class="object">res</span>.<span class="property">writeHead</span>(200, { <span class="string">&#39;content-type&#39;</span>: <span class="string">&#39;text<span class="keyword">/</span>plain&#39;</span> })</code><code class="line">    <span class="object">res</span>.<span class="property">end</span>(`hello, ${name}`)</code><code class="line">  },</code><code class="line">}</code></pre></div></div></div><footer class="Footer"><div class="Container">made with a few bits of <a target="_blank" rel="noopener" href="https://github.com/magic/core">magic</a></div></footer></div></div><script type="module" src="/magic.mjs?CcmXLyaWKQy"></script></body></html>