<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/core/favicon.ico"/><title>@magic/core concepts</title><meta name="description" content="@magic/core conceptual information."/><link rel="stylesheet" href="/core/magic.css"/></head><body><div id="magic"><div class="wrapper"><header class="main"><a class="logo-wrapper" href="/core/"><img class="logo" src="/core/logo.png" role="presentation" alt=""/><span class="logo-text">@magic</span></a><nav class="Menu"><ul><li><a href="/core/concepts/">concepts</a></li><li><a href="/core/files/">files &amp; directories</a></li><li><a href="/core/modules/">modules</a></li><li><a href="/core/themes/">themes</a></li></ul></nav></header><div class="page"><h1>@magic/core concepts</h1><p>magic concepts. These are the building blocks of every module in a magic app</p><div><h2 id="philosophy">philosophy</h2></div><div><h2 id="modules">modules</h2><p>modules are the main building block of magic.</p><p>modules can include state, actions, style and multiple components (which we call Views).</p><p>View names have to start with an uppercased character. Every module can export multiple components that share state, actions and styles.</p></div><div><h2 id="state">state</h2><div><p>state is a javascript object.</p><p>state can be mutated by actions.</p><p>every rendering step, the state determines the output of the view</p><h3 id="state-example">state example</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// state variables can be anything you can JSON.stringify()</code></code><code class="line"><span class="state">state</span>: {</code><code class="line">  <span class="colon">variable</span>: <span class="boolean">true</span>,</code><code class="line">  <span class="colon">args</span>: <span class="string">&#39;none&#39;</span>,</code><code class="line">}</code></pre></div></div></div><div><h2 id="actions">actions</h2><p>actions are an object containing functions</p><p>those functions get the state and actions and may return a new partial state.</p><p>alternatively, you can call any action from within any other action.</p><h3 id="actions-example">actions example</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// actions are an object containing functions.</code></code><code class="line"><code class="line comment">// if an action returns an object, this object gets merged into the state</code></code><code class="line"><span class="actions">actions</span>: {</code><code class="line">  <span class="colon">changeVariable</span>: args =&gt; <span class="state">state</span> =&gt; ({</code><code class="line">    <span class="colon">variable</span>: !<span class="state">state</span>.<span class="property">variable</span>,</code><code class="line">    args,</code><code class="line">  }),</code><code class="line">  <span class="colon">callActionInAction</span>: () =&gt; <span class="keyword">async</span> (<span class="state">state</span>, <span class="actions">actions</span>) =&gt; {</code><code class="line"><code class="line comment">    // just await something inside an action to create an async action</code></code><code class="line">    <span class="keyword">await</span><span class="keyword"> </span><span class="keyword">new</span><span class="keyword"> </span><span class="builtin">Promise</span>(resolve =&gt; {</code><code class="line">      <span class="builtin">setTimeout</span>(resolve, 200)</code><code class="line">    })</code><code class="line"></code><code class="line"><code class="line comment">    // actions can call other actions</code></code><code class="line">    <span class="actions">actions</span>.<span class="property">changeVariable</span>(<span class="string">&#39;arg passed to function&#39;</span>)</code><code class="line">  },</code><code class="line">}</code></pre></div></div><div><h2 id="views">views</h2><p>views render the state to html</p><p>whenever an action triggers a statechange, this statechange then triggers a view change.</p><h3 id="views-example">views example</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">View</span>: (<span class="state">state</span>, <span class="actions">actions</span>) =&gt; (</code><code class="line">  div({ <span class="colon">onclick</span>: <span class="actions">actions</span>.<span class="property">callActionInAction</span> }, <span class="state">state</span>.<span class="property">variable</span>)</code><code class="line">)</code></pre></div></div><div><h2 id="styles">styles</h2><p>every module can have a style object attached to it.</p><p>magic will automagically merge all styles into one global css file.</p><p>in the future, it will also remove unused styles for you.</p><p>style merge order from lowest to highest:</p><p>module.style &lt; page.style &lt; app.style &lt; theme.style</p><h3 id="styles-example">example styles</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">style</span>: {</code><code class="line">  <span class="string">&#39;.className&#39;</span>: {</code><code class="line">    <span class="colon">color</span>: <span class="string">&#39;green&#39;</span>,</code><code class="line"></code><code class="line"><code class="line comment">    // expands to .className:hover because of the &amp;</code></code><code class="line">    <span class="string">&#39;&amp;:hover&#39;</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;orange&#39;</span>,</code><code class="line">    },</code><code class="line"></code><code class="line"><code class="line comment">    // expands to .className .childClass</code></code><code class="line">    <span class="string">&#39;.childClass&#39;</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;blue&#39;</span>,</code><code class="line">    },</code><code class="line">  },</code><code class="line"><code class="line comment">  // css ids</code></code><code class="line">  <span class="string">&#39;#id&#39;</span>: {</code><code class="line">    <span class="colon">color</span>: <span class="string">&#39;yellow&#39;</span>,</code><code class="line">  },</code><code class="line"><code class="line comment">  // default html tag styles</code></code><code class="line">  <span class="colon">div</span>: {</code><code class="line">    <span class="colon">color</span>: <span class="string">&#39;black&#39;</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div><h3 id="styles-magic-css">@magic/css</h3><p>internally, magic uses it&#39;s own css-in-js library.</p><p>to find out more, click the following link:</p><a href="https://magic.github.io/css/" target="_blank" rel="noopener">@magic/css</a></div><div><h2 id="globals">global</h2><p>every module can set a global object, containing state and action properties.</p><p>every key in the mod.global object that is set to true gets merged into the main app state/actions.</p><h3 id="globals-example">global example</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">global</span>: {</code><code class="line">  <span class="state">state</span>: {</code><code class="line">    <span class="colon">variable</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">args</span>: <span class="boolean">true</span>,</code><code class="line">  },</code><code class="line">  <span class="actions">actions</span>: {</code><code class="line">    <span class="colon">callActionInAction</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">changeVariable</span>: <span class="boolean">true</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div></div><div><h2 id="lambdas">server lambdas</h2><p>this is the serverside magic.</p><p>you can define functions that will turn into serverside lambdas.</p><p>server side lambdas will be available for POST requests.</p><p>the server side function signature is (req, res) =&gt; {}, as in any nodejs http server, with the addition of req.body being set.</p><h3 id="lambdas-example">single lambda</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">server</span>: (<span class="keyword">req</span>, res) =&gt; {</code><code class="line">  <span class="keyword">const</span> { name } = <span class="keyword">req</span>.<span class="property">body</span></code><code class="line">  <span class="object">res</span>.<span class="property">writeHead</span>(200, { <span class="string">&#39;content-type&#39;</span>: <span class="string">&#39;text/plain&#39;</span> })</code><code class="line">  <span class="object">res</span>.<span class="keyword">end</span>(`hello, ${name}`)</code><code class="line">}</code></pre></div><h3 id="lambdas-example-multi">multiple lambdas</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="colon">server</span>: {</code><code class="line">  <span class="colon">index</span>: (<span class="keyword">req</span>, res) =&gt; {</code><code class="line">    <span class="object">res</span>.<span class="property">writeHead</span>(200, { <span class="string">&#39;content-type&#39;</span>: <span class="string">&#39;text/plain&#39;</span> })</code><code class="line">    <span class="object">res</span>.<span class="keyword">end</span>(<span class="string">&#39;index route&#39;</span>)</code><code class="line">  },</code><code class="line">  <span class="colon">route</span>: (<span class="keyword">req</span>, res) =&gt; {</code><code class="line">    <span class="object">res</span>.<span class="property">writeHead</span>(200, { <span class="string">&#39;content-type&#39;</span>: <span class="string">&#39;text/plain&#39;</span> })</code><code class="line">    <span class="object">res</span>.<span class="keyword">end</span>(<span class="string">&#39;api route&#39;</span>)</code><code class="line">  },</code><code class="line">}</code></pre></div></div><div><h2 id="libs">external libs</h2><p>what would javascript be without the millions of dependencies that you can easily install and make the average webpage  slow[ly] (pun intended) grow towards a footprint of 5 megabytes.</p><p>as the sarcastic remark might demonstrate, we think that all of that bloat is unneeded, unheeded and, frankly, not optimal.</p><p>magic has one external client side dependency, <a href="https://github.com/jorgebucharan/hyperapp" target="_blank" rel="noopener">hyperapp</a>, [~400 lines that provide our ui state machine]. thats it. and it won&#39;t change.</p><p>anyways, rant over. if you really need to use external packages, there is a way.</p><p>once there is a lib key in at least one component, window.LIB (browser) and global.LIB (nodejs) will be set, aliasing LIB as a global variable in both environments</p><h3 id="libs-dir-or-file">lib dir or file</h3><p>if you need libraries in internally developed modules, it might be easier to keep your library dependencies in a central place. to achieve this, one can simply create /assets/lib.js and export a object from it. the keys of the object are the function name, the values are the paths to the lib.js file</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// /assets/lib.js or /assets/lib/index.js</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line">  <span class="colon">local</span>: <span class="keyword">require</span>.<span class="property">resolve</span>(<span class="string">&#39;./local.js&#39;</span>),</code><code class="line">  <span class="colon">npm</span>: <span class="string">&#39;npm-lib&#39;</span>,</code><code class="line">}</code></pre></div><h3 id="libs-example-file">example lib file</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// /assets/lib/local.js</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = name =&gt; `hello, ${name}`</code></pre></div><h3 id="libs-app">app.lib</h3><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// /assets/app.js</code></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line"><code class="line comment">  // ... other app props</code></code><code class="line">  <span class="colon">lib</span>: {</code><code class="line">    <span class="colon">local</span>: <span class="keyword">require</span>.<span class="property">resolve</span>(<span class="string">&#39;./lib&#39;</span>),</code><code class="line">    <span class="colon">npm</span>: <span class="string">&#39;npm-lib&#39;</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div><h3 id="libs-module">module.lib</h3><p>any page or module can export a lib key</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// /pages/page.js</code></code><code class="line"><code class="line comment">// /assets/Module.js</code></code><code class="line"></code><code class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</code><code class="line"><code class="line comment">  // ... other component / page properties and views    </code></code><code class="line">  <span class="colon">lib</span>: {</code><code class="line">    <span class="colon">local</span>: <span class="keyword">require</span>.<span class="property">resolve</span>(<span class="string">&#39;./lib/local.js&#39;</span>),</code><code class="line">    <span class="colon">npm</span>: <span class="string">&#39;npm-lib&#39;</span>,</code><code class="line">  }</code><code class="line">},</code><code class="line"><span class="colon">View</span>: () =&gt; div(<span class="object">LIB</span>.<span class="property">local</span>(<span class="string">&#39;name&#39;</span>)),</code><code class="line">}</code><code class="line"></code><code class="line"><code class="line comment">// renders</code></code><code class="line">&lt;div&gt;hello, name&lt;/div&gt;</code></pre></div></div><div><h2 id="full-example">Full example</h2><p>If we assemble those pieces, we get the following:</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>exampleModule = {</code><code class="line">    </code><code class="line"><code class="line comment">  // state variables can be anything you can JSON.stringify()</code></code><code class="line">  <span class="state">state</span>: {</code><code class="line">    <span class="colon">variable</span>: <span class="boolean">true</span>,</code><code class="line">    <span class="colon">args</span>: <span class="string">&#39;none&#39;</span>,</code><code class="line">  },</code><code class="line">    </code><code class="line"><code class="line comment">  // actions are an object containing functions.</code></code><code class="line"><code class="line comment">  // if an action returns an object, this object gets merged into the state</code></code><code class="line">  <span class="actions">actions</span>: {</code><code class="line">    <span class="colon">changeVariable</span>: args =&gt; <span class="state">state</span> =&gt; ({</code><code class="line">      <span class="colon">variable</span>: !<span class="state">state</span>.<span class="property">variable</span>,</code><code class="line">      args,</code><code class="line">    }),</code><code class="line">    <span class="colon">callActionInAction</span>: () =&gt; <span class="keyword">async</span> (<span class="state">state</span>, <span class="actions">actions</span>) =&gt; {</code><code class="line"><code class="line comment">      // just await something inside an action to create an async action</code></code><code class="line">      <span class="keyword">await</span><span class="keyword"> </span><span class="keyword">new</span><span class="keyword"> </span><span class="builtin">Promise</span>(resolve =&gt; {</code><code class="line">        <span class="builtin">setTimeout</span>(resolve, 200)</code><code class="line">      })</code><code class="line">  </code><code class="line"><code class="line comment">      // actions can call other actions</code></code><code class="line">      <span class="actions">actions</span>.<span class="property">changeVariable</span>(<span class="string">&#39;arg passed to function&#39;</span>)</code><code class="line">    },</code><code class="line">  },</code><code class="line">    </code><code class="line">  <span class="colon">style</span>: {</code><code class="line">    <span class="string">&#39;.className&#39;</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;green&#39;</span>,</code><code class="line">  </code><code class="line"><code class="line comment">      // expands to .className:hover because of the &amp;</code></code><code class="line">      <span class="string">&#39;&amp;:hover&#39;</span>: {</code><code class="line">        <span class="colon">color</span>: <span class="string">&#39;orange&#39;</span>,</code><code class="line">      },</code><code class="line">  </code><code class="line"><code class="line comment">      // expands to .className .childClass</code></code><code class="line">      <span class="string">&#39;.childClass&#39;</span>: {</code><code class="line">        <span class="colon">color</span>: <span class="string">&#39;blue&#39;</span>,</code><code class="line">      },</code><code class="line">    },</code><code class="line"><code class="line comment">    // css ids</code></code><code class="line">    <span class="string">&#39;#id&#39;</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;yellow&#39;</span>,</code><code class="line">    },</code><code class="line"><code class="line comment">    // default html tag styles</code></code><code class="line">    <span class="colon">div</span>: {</code><code class="line">      <span class="colon">color</span>: <span class="string">&#39;black&#39;</span>,</code><code class="line">    },</code><code class="line">  },</code><code class="line">    </code><code class="line">  <span class="colon">View</span>: (<span class="state">state</span>, <span class="actions">actions</span>) =&gt; (</code><code class="line">    div({ <span class="colon">onclick</span>: <span class="actions">actions</span>.<span class="property">callActionInAction</span> }, <span class="state">state</span>.<span class="property">variable</span>)</code><code class="line">  ),</code><code class="line">    </code><code class="line">  <span class="colon">global</span>: {</code><code class="line">    <span class="state">state</span>: {</code><code class="line">      <span class="colon">variable</span>: <span class="boolean">true</span>,</code><code class="line">      <span class="colon">args</span>: <span class="boolean">true</span>,</code><code class="line">    },</code><code class="line">    <span class="actions">actions</span>: {</code><code class="line">      <span class="colon">callActionInAction</span>: <span class="boolean">true</span>,</code><code class="line">      <span class="colon">changeVariable</span>: <span class="boolean">true</span>,</code><code class="line">    },</code><code class="line">  },</code><code class="line">    </code><code class="line">  <span class="colon">lib</span>: {</code><code class="line">    <span class="colon">local</span>: <span class="keyword">require</span>.<span class="property">resolve</span>(<span class="string">&#39;./lib/local.js&#39;</span>),</code><code class="line">    <span class="colon">npm</span>: <span class="string">&#39;npm-lib&#39;</span>,</code><code class="line">  },</code><code class="line">    </code><code class="line">  <span class="colon">server</span>: (<span class="keyword">req</span>, res) =&gt; {</code><code class="line">    <span class="keyword">const</span> { name } = <span class="keyword">req</span>.<span class="property">body</span></code><code class="line">    <span class="object">res</span>.<span class="property">writeHead</span>(200, { <span class="string">&#39;content-type&#39;</span>: <span class="string">&#39;text/plain&#39;</span> })</code><code class="line">    <span class="object">res</span>.<span class="keyword">end</span>(`hello, ${name}`)</code><code class="line">  },</code><code class="line">}</code></pre></div></div></div><footer class="main"><div class="wrapper">made with a few bits of <a target="_blank" rel="noopener" href="https://github.com/magic/core">magic</a></div></footer></div></div><script type="text/javascript" src="/core/magic.js"></script></body></html>